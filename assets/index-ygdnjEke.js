import{j as t,o as k,p as R,r as x,q as B,v as V,w as G,x as q,y as J,z as N,B as U,C as W,D as K,E as Q,F as w,c as m,A as b,G as y,H as X,l as Y,m as Z,I as ee,R as F,a as te,J as se,u as ne,T as ae,O as ie}from"./index-BYT0V1gO.js";import{B as oe}from"./index-BYWxSTIH.js";import{E as re}from"./Edit-BXfskQEj.js";import{N as ce}from"./NoteAdd-BSkyQwFr.js";const le=({children:e,...s})=>t.jsx("i",{"data-name":"bi",className:e,...s}),H=k("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),z=k("MuiListItemIcon",["root","alignItemsFlexStart"]),L=k("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function de(e){return R("MuiMenuItem",e)}const I=k("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),pe=(e,s)=>{const{ownerState:a}=e;return[s.root,a.dense&&s.dense,a.divider&&s.divider,!a.disableGutters&&s.gutters]},me=e=>{const{disabled:s,dense:a,divider:n,disableGutters:i,selected:l,classes:d}=e,u=U({root:["root",a&&"dense",s&&"disabled",!i&&"gutters",n&&"divider",l&&"selected"]},de,d);return{...d,...u}},ue=J(W,{shouldForwardProp:e=>K(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:pe})(Q(({theme:e})=>({...e.typography.body1,display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap","&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${I.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${I.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:w(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${I.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:w(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:w(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${I.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${I.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${H.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${H.inset}`]:{marginLeft:52},[`& .${L.root}`]:{marginTop:0,marginBottom:0},[`& .${L.inset}`]:{paddingLeft:36},[`& .${z.root}`]:{minWidth:36},variants:[{props:({ownerState:s})=>!s.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:s})=>s.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:s})=>!s.dense,style:{[e.breakpoints.up("sm")]:{minHeight:"auto"}}},{props:({ownerState:s})=>s.dense,style:{minHeight:32,paddingTop:4,paddingBottom:4,...e.typography.body2,[`& .${z.root} svg`]:{fontSize:"1.25rem"}}}]}))),g=x.forwardRef(function(s,a){const n=B({props:s,name:"MuiMenuItem"}),{autoFocus:i=!1,component:l="li",dense:d=!1,divider:_=!1,disableGutters:u=!1,focusVisibleClassName:h,role:C="menuitem",tabIndex:f,className:o,...p}=n,c=x.useContext(V),v=x.useMemo(()=>({dense:d||c.dense||!1,disableGutters:u}),[c.dense,d,u]),j=x.useRef(null);G(()=>{i&&j.current&&j.current.focus()},[i]);const D={...n,dense:v.dense,divider:_,disableGutters:u},M=me(n),P=q(j,a);let $;return n.disabled||($=f!==void 0?f:-1),t.jsx(V.Provider,{value:v,children:t.jsx(ue,{ref:P,role:C,tabIndex:$,component:l,focusVisibleClassName:N(M.focusVisible,h),className:N(M.root,o),...p,ownerState:D,classes:M})})}),E=e=>{const s=e.split("_");if(!s)return{baseName:"name",isHidden:!1};const a=s.find(i=>i==="hidden"),n=s[0];return{isHidden:a,baseName:n}},he="_admin_nkbig_1",xe="_admin_container_nkbig_5",_e="_admin__tools_nkbig_8",ve="_tree_item_nkbig_17",ge="_back_nkbig_21",fe="_article_title_nkbig_42",be="_tree_item_dropdown_nkbig_51",ye="_active_nkbig_56",je="_tree_item_header_nkbig_59",Ce="_tree_item_header_container_nkbig_74",Ie="_focused_nkbig_87",we="_admin__content_nkbig_90",r={admin:he,admin_container:xe,admin__tools:_e,tree_item:ve,back:ge,article_title:fe,tree_item_dropdown:be,active:ye,tree_item_header:je,tree_item_header_container:Ce,focused:Ie,admin__content:we},ke=m([t.jsx("path",{d:"M21 3H3c-1.1 0-2 .9-2 2v8h2V5h18v16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"},"0"),t.jsx("circle",{cx:"9",cy:"10",r:"4"},"1"),t.jsx("path",{d:"M15.39 16.56C13.71 15.7 11.53 15 9 15s-4.71.7-6.39 1.56C1.61 17.07 1 18.1 1 19.22V22h16v-2.78c0-1.12-.61-2.15-1.61-2.66"},"2")],"CoPresent"),Me=m(t.jsx("path",{d:"m22 3-1.67 1.67L18.67 3 17 4.67 15.33 3l-1.66 1.67L12 3l-1.67 1.67L8.67 3 7 4.67 5.33 3 3.67 4.67 2 3v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zM11 19H4v-6h7zm9 0h-7v-2h7zm0-4h-7v-2h7zm0-4H4V8h16z"}),"Newspaper"),$e=m(t.jsx("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),Ve=m(t.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections"),Ne=m(t.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),He=m(t.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),T=m(t.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),ze=m(t.jsx("path",{d:"M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-1 8h-3v3h-2v-3h-3v-2h3V9h2v3h3z"}),"CreateNewFolder"),Le=m(t.jsx("path",{d:"M22 3H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2M9 8c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3M2.08 19c1.38-2.39 3.96-4 6.92-4s5.54 1.61 6.92 4zm18.89-9.15-.75 1.3-1.47-.85V12h-1.5v-1.7l-1.47.85-.75-1.3L16.5 9l-1.47-.85.75-1.3 1.47.85V6h1.5v1.7l1.47-.85.75 1.3L19.5 9z"}),"ContactEmergency"),Se=m(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),Oe=m(t.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),Fe=m(t.jsx("path",{d:"M3.5 9H5v6H3.5v-2.5h-2V15H0V9h1.5v2h2zm14 0H13c-.55 0-1 .45-1 1v5h1.5v-4.5h1V14H16v-3.51h1V15h1.5v-5c0-.55-.45-1-1-1M11 9H6v1.5h1.75V15h1.5v-4.5H11zm13 6v-1.5h-2.5V9H20v6z"}),"Html"),Ee={gallery:"Картинка",summary:"Шаблон справки",news:"Шаблон новости",pages:"Шаблон страницы",staff:"Шаблон сотрудника"},Te=({data:e,parent:s,children:a,className:n,onClick:i,isCatalog:l})=>{const[d,_]=x.useState(null),{baseName:u,isHidden:h}=E(e.name),C=!!d,f=p=>{p.preventDefault(),_(p.currentTarget)},o=x.useMemo(()=>async({type:p})=>{switch(p){case"rename":{let c=await prompt("Введите новое название для раздела: ");if(!c)return _(null);await b.renameCatalog({id:e.id,title:c,name:e.name}),y()}break;case"drop":{if(!await confirm(l?"Раздел удаляется со всеми дочерними элементами! Действительно удалить? ":"Вы действительно хотите удалить экземпляр? "))return;l?await b.dropCatalog(e.id):await b.dropArticle(e.id),y()}break;case"addArticle":await b.addArticle({...e,title:Ee[s]||"Экземпляр"}),y();break;case"addCatalog":{const c=await prompt("Введите название для раздела: "),v=await prompt("Введите текст для ссылки на раздел: (ENG)");if(!c){alert("Требуется ввести название и текст ссылки для создания раздела");return}const j=v||ct.transform(c,"_").toLowerCase();console.log(j),await b.addCatalog({id:e.id,title:c,name:j}),y()}break;case"hide":{const c=h?u:`${u}_hidden`;await b.renameCatalog({id:e.id,title:e.title,name:c}),y()}break;case"hardcode":await b.saveArticle({id:e.id,content_type:"html"}),y();break}_(null)},[]);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:n,onClick:i,id:"basic-button",onContextMenu:f,children:a}),t.jsxs(X,{id:"basic-menu",anchorEl:d,open:C,onClose:o,MenuListProps:{"aria-labelledby":"basic-button"},children:[l?t.jsxs(t.Fragment,{children:[t.jsxs(g,{onClick:()=>o({type:"addArticle"}),children:[t.jsx(ce,{}),"Создать экземпляр"]}),t.jsxs(g,{onClick:()=>o({type:"addCatalog"}),children:[t.jsx(ze,{}),"Создать раздел"]}),t.jsxs(g,{onClick:o,children:[t.jsx(Le,{}),"Права доступа"]}),t.jsxs(g,{onClick:()=>o({type:"rename"}),children:[t.jsx(re,{}),"Переименовать"]})]}):t.jsx(t.Fragment,{children:t.jsxs(g,{onClick:()=>o({type:"hardcode"}),children:[t.jsx(Fe,{}),"Превратить во Фрейм"]})}),t.jsxs(g,{onClick:()=>o({type:"hide"}),children:[t.jsx(T,{}),h?"Сделать видимым":"Сделать невидимым"]}),t.jsxs(g,{onClick:()=>o({type:"drop"}),children:[t.jsx(Se,{}),"Удалить ",l?"раздел":"экземпляр"]}),t.jsxs(g,{onClick:()=>{navigator.clipboard.writeText(e.id),alert("Полный id скопирован в буфер обмена")},children:[t.jsx(Oe,{}),"ID: ",e.id.slice(0,6)]})]})]})},S={news:t.jsx(Me,{}),pages:t.jsx($e,{}),gallery:t.jsx(Ve,{}),summary:t.jsx(se,{}),staff:t.jsx(He,{})},A=({data:e,parent:s,params:a})=>{const{isHidden:n}=E(e.name),i=e.type==="catalog",l=Z(),_=s?s&&i?`${s}/${e.name}`:`${s}/${e.id}`:e.name,u=a.id===e.id,[h,C]=x.useState(()=>{const o=localStorage.getItem("tree-expanded");return(o?JSON.parse(o):{})[e.id]||!1}),f=()=>{i&&C(o=>{const p=!o,c=localStorage.getItem("tree-expanded"),v=c?JSON.parse(c):{};return v[e.id]=p,localStorage.setItem("tree-expanded",JSON.stringify(v)),p})};return t.jsxs("div",{className:`${r.tree_item} ${h?r.active:""}`,children:[t.jsx("div",{onContextMenu:()=>!h&&f(),className:r.tree_item_header_container,children:t.jsx(Te,{parent:s,data:e,className:[r.tree_item_header,h?r.active:"",u?r.focused:""].join(" "),isCatalog:i,onClick:f,children:i?t.jsxs(t.Fragment,{children:[t.jsx("i",{children:t.jsx(ee,{})}),S.hasOwnProperty(e.name)?S[e.name]:null,t.jsx("span",{children:e.title}),n&&t.jsx(T,{})]}):t.jsx(t.Fragment,{children:t.jsxs(F,{className:r.article_title,to:_,onClick:()=>l(te(e)),children:[t.jsx(Ne,{}),t.jsx("span",{children:e.title})]})})})}),i&&h&&"entries"in e&&e.entries&&t.jsx("div",{className:`${r.tree_item_dropdown} ${h?r.active:""}`,children:e.entries.map((o,p)=>t.jsx(A,{data:o,parent:_,params:a},p))})]})},Ae=({catalogs:e})=>{const s=Y();return e==null?void 0:e.map((a,n)=>t.jsx(A,{data:a,params:s},n))};function De(){const{catalogs:e}=ne(n=>n.catalogs),[s,a]=x.useState(!0);return x.useEffect(()=>{y()},[]),t.jsxs("div",{className:r.admin,children:[t.jsx(oe,{onClick:()=>a(n=>!n),children:"Нажми чтобы скрыть/показать"}),t.jsxs("div",{className:r.admin_container,children:[s&&t.jsxs("div",{className:r.admin__tools,children:[t.jsxs(ae,{size:"2em",children:[t.jsx(le,{children:"bi bi-gear"})," СКР-Админ"]}),t.jsx(Ae,{catalogs:e}),t.jsx("div",{className:`${r.tree_item} ${r.back}`,children:t.jsxs(F,{className:r.tree_item_header,to:"/",children:[t.jsx(ke,{})," Вернуться на сайт"]})})]}),t.jsx("div",{className:r.admin__content,children:t.jsx(ie,{})})]})]})}const Pe="_admin_container_1p6wd_1",O={admin_container:Pe},Re=({children:e,className:s,...a})=>(x.useEffect(()=>{const n=document.querySelector("header"),i=document.querySelector("nav"),l=document.querySelector("footer"),d=document.querySelector("#wrapper");if(!(!n||!l||!i||!d))return n.style.display="none",l.style.display="none",i.style.display="none",d.classList.add("wrapper-admin"),()=>{d.classList.remove("wrapper-admin"),n.style.display="flex",l.style.display="flex",i.style.display="flex"}},[]),t.jsx("div",{className:`${O.admin} ${s}`,...a,children:t.jsx("div",{className:`flex column ${O.admin_container}`,children:t.jsx(De,{})})})),Ue=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{le as I,Ue as a,Re as i};
