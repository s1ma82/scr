import{c as k,j as e,k as S,u as T,l as $,r as p,q as L,g as D,A as f,a as A,T as E,E as I,t as O,n as w}from"./index-UEI1YxYj.js";import{u as F,s as n,S as H}from"./SaveAs-Cze-1JHp.js";import{g as z,F as K,L as P,S as q}from"./getToolbarItems-DdYZdBEI.js";import{B}from"./index-DYqr8K2Z.js";import{I as h,T as l}from"./Tooltip-waiKIL0u.js";import"./Add-Ce1YqQEB.js";import"./NoteAdd-DtGGjVGr.js";const M=k(e.jsx("path",{d:"M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5m-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3z"}),"LinkOff"),Z=({initialContent:R,...g})=>{const{id:c}=S(),{focusedArticles:j}=T(t=>t.catalogs),v=$();localStorage.getItem("saved-template");const[r,u]=F({title:"",link:"",tags:[],publishDate:"",author:"",date:"",textOnly:"",content_type:""}),[b,x]=p.useState(),[m,N]=p.useState(!1),d=r("content_type")==="html",i=L({extensions:O,content:b,onUpdate:({editor:t})=>{const s=t.getJSON(),o=t.getText();u("textOnly",o),x(d?o:s)},editorProps:{handleKeyDown(t,s){return s.ctrlKey&&s.key==="Enter"?(t.dispatch(t.state.tr.insertText(`
`)),s.preventDefault(),!0):s.ctrlKey&&s.key==="k"?i?(s.preventDefault(),i.isActive("link")?(i.commands.unsetLink(),!0):(async()=>{const o=await prompt("Введите URL:");return o&&i.chain().focus().toggleLink({href:o}).run(),!0})()):void 0:!1}}});p.useEffect(()=>{c&&(async()=>{try{const t=j.find(o=>o.id===c);if(t){const o=await D(t.content);console.log("Content",o);const C={title:t.title,tags:o.tags,publishDate:o.publishDate,author:t.author,date:o.date,link:t.name,content_type:t.content_type};i.commands.setContent(o.content),x(o.content),u("",C),console.log("Подгрузка из store: ",t);return}const s=await f.getArticle(c);v(A(s));return}catch(t){console.error(t)}})()},[j,c]);const _=()=>d?"html":m?"link":"json",y=async()=>{if(!c)return;const t=r("publishDate"),s={id:c,title:r("title"),content_type:_(),content:b,text_only:r("textOnly")},o=r("link");o&&(s.name=o),console.log(o),t&&(s.content.publishDate=t),await f.saveArticle(s),alert("Сохранено"),w()};if(!i)return null;const a=z({editor:i,isFrame:d,styles:n});return e.jsxs("div",{className:`${n.tiptapeditor}`,...g,children:[e.jsx(h,{name:"title",className:n.name,placeholder:"Название статьи",onChange:t=>u(t.currentTarget.name,t.currentTarget.value),value:r("title")}),d?e.jsx(E,{size:"1em",children:"Режим Фрейма позволит использовать html для создания страницы"}):e.jsxs("div",{className:n.toolbar,children:[!m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(0,2).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},s))},"section-1"),e.jsx("div",{className:n.toolbar_section,children:a.slice(2,5).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#1`))},"section-2"),e.jsx("div",{className:n.toolbar_section,children:a.slice(5,8).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#2`))},"section-3"),e.jsxs("div",{className:n.toolbar_section,children:[a.slice(8,9).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#3`)),e.jsx(h,{className:a[9].className,title:a[9].name,onChange:a[9].onChange,type:"file",children:a[9].children}),e.jsx(h,{className:a[10].className,title:a[10].name,onChange:a[10].onChange,type:"file",children:a[10].children})]},"section-4"),e.jsx("div",{className:n.toolbar_section,children:a.slice(11,14).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#4`))},"section-5"),e.jsx("div",{className:n.toolbar_section,children:a.slice(14,16).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#5`))},"section-6")]}),e.jsx("div",{className:n.toolbar_section,children:e.jsx(l,{title:"ссылка",children:e.jsx(K,{control:e.jsx(q,{checked:m,onChange:()=>N(!m)}),label:m?e.jsx(P,{}):e.jsx(M,{})})})},"section-6.1")]}),i.isActive("table")&&e.jsxs("div",{className:`${n.toolbar} ${n.toolbar_sub}`,children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(16,18).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#6`))},"section-7"),e.jsx("div",{className:n.toolbar_section,children:a.slice(18,20).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#7`))},"section-8"),e.jsx("div",{className:n.toolbar_section,children:a.slice(20,22).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#8`))},"section-9"),e.jsx("div",{className:n.toolbar_section,children:a.slice(22,24).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#9`))},"section-10"),e.jsx("div",{className:n.toolbar_section,children:a.slice(24,26).map((t,s)=>e.jsx(l,{title:t.name,children:e.jsx("button",{...t})},`${s}#10`))},"section-11")]}),m?e.jsx(h,{placeholder:"Ссылка на страницу",onChange:({target:t})=>u("link",t.value)}):e.jsx(I,{editor:i,className:`${d?"":"tiptap_content"} editor`}),e.jsx("div",{className:n.submit_menu,children:e.jsxs(B,{onClick:y,className:n.submit_menu__item,children:[e.jsx(H,{}),"Сохранить изменения"]})})]})};export{Z as default};
