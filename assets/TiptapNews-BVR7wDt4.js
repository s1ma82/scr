const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D_1BPoYO.js","assets/index-CpVzDFJ0.css"])))=>i.map(i=>d[i]);
import{c as I,j as e,r as u,g as N,L as $,t as y,k as A,u as L,l as k,q as T,A as _,a as O,E as P,n as J,v as R,_ as H}from"./index-D_1BPoYO.js";import{E as U}from"./Edit-DHaeua8l.js";import{E as F}from"./EditOff-DlkWyx9S.js";import{u as K,s as n,S as M}from"./SaveAs-BCkdBN51.js";import{B as g}from"./index-D5VRk-O1.js";import{I as b,T as i}from"./Tooltip-CrsZz9NA.js";import{g as q,F as z,S as B}from"./getToolbarItems-CSEsFtfY.js";import{g as V}from"./index-BM283jf1.js";import{A as G}from"./index-BEuuVA1e.js";import"./Add-Cyx5ekiK.js";import"./NoteAdd-txXP_cUs.js";const Q=I(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"Done"),W=({children:f,data:h,className:d,...x})=>{const[j,c]=u.useState(null);if(u.useEffect(()=>{h&&(async()=>{const{content:r}=await N(h.content);r&&c(r)})()},[h]),!j)return null;const m=V(j,y);return e.jsx($,{to:`/news/${h.id}`,...x,children:e.jsx("div",{className:"news_post tiptap_content",dangerouslySetInnerHTML:{__html:m}})})};var X={API_URL:"https://scr.opolo.me/api"};const Y=u.lazy(()=>H(()=>import("./index-D_1BPoYO.js").then(f=>f.ao),__vite__mapDeps([0,1]))),dt=({initialContent:f,...h})=>{const{id:d}=A(),{focusedArticles:x}=L(t=>t.catalogs),j=k(),[c,m]=K({title:"",tags:[],publishDate:"",author:"",date:"",textOnly:"",avatar:""}),[r,S]=u.useState(),[p,C]=u.useState(!0),l=T({extensions:y,content:r,onUpdate:({editor:t})=>{const s=t.getJSON(),o=t.getText();m("textOnly",o),S(s)},editorProps:{handleKeyDown(t,s){return s.ctrlKey&&s.key==="Enter"?(t.dispatch(t.state.tr.insertText(`
`)),s.preventDefault(),!0):s.ctrlKey&&s.key==="k"?l?(s.preventDefault(),l.isActive("link")?(l.commands.unsetLink(),!0):(async()=>{const o=await prompt("Введите URL:");return o&&l.chain().focus().toggleLink({href:o}).run(),!0})()):void 0:!1}}});u.useEffect(()=>{d&&(async()=>{try{const t=x.find(o=>o.id===d);if(t){const o=await N(t.content),v={title:t.title,tags:o.tags,publishDate:o.publishDate,author:t.author,date:o.date,avatar:t.avatar};console.log("prevContent.content",o.content),l.commands.setContent(o.content),m("",v),console.log("Подгрузка из store: ",t);return}const s=await _.getArticle(d);console.log("Подгрузка с сервера: ",s),j(O(s));return}catch(t){console.error(t)}})()},[x,d]);const E=()=>{const t=localStorage.getItem("saved-news"),s=t?JSON.parse(t):[],o={...c(),content:JSON.stringify(r)};s.push(o),localStorage.setItem("saved-news",JSON.stringify(s))},D=async()=>{if(!d)return;const t=c("publishDate");console.log(r);const s={id:d,title:c("title"),content:r,text_only:c("textOnly"),avatar:c("avatar")};t&&(s.content.publishDate=t),await _.saveArticle(s),J()};if(u.useEffect(()=>{l&&l.setEditable(p)},[p]),!l)return null;const a=q({editor:l,styles:n}),w=async t=>{const s=t.target.files[0];if(!s)return;const o=await R(s);o&&m("avatar",o)};return e.jsxs("div",{className:`${n.tiptapeditor}`,...h,children:[e.jsx(b,{name:"title",className:n.name,placeholder:"Название статьи",onChange:t=>m(t.currentTarget.name,t.currentTarget.value),value:c("title")}),e.jsx("div",{className:n.avatar_container,children:e.jsx(i,{title:"Нажмите, чтобы сменить превью новости",children:e.jsx("div",{className:n.avatar,children:e.jsx(G,{type:"editor",className:n.news,onChange:w,src:`${X.API_URL}/files/${c("avatar")}`,alt:c("name")})})})}),e.jsxs("div",{className:n.toolbar,children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(0,2).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},s))},"section-1"),e.jsx("div",{className:n.toolbar_section,children:a.slice(2,5).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#1`))},"section-2"),e.jsx("div",{className:n.toolbar_section,children:a.slice(5,8).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#2`))},"section-3"),e.jsxs("div",{className:n.toolbar_section,children:[a.slice(8,9).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#3`)),e.jsx(b,{className:a[9].className,title:a[9].name,onChange:a[9].onChange,type:"file",children:a[9].children}),e.jsx(b,{className:a[10].className,title:a[10].name,onChange:a[10].onChange,type:"file",children:a[10].children})]},"section-4"),e.jsx("div",{className:n.toolbar_section,children:a.slice(11,14).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#4`))},"section-5"),e.jsx("div",{className:n.toolbar_section,children:a.slice(14,16).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#5`))},"section-6"),e.jsx("div",{className:n.toolbar_section,children:e.jsx(i,{title:"режим редактирования",children:e.jsx(z,{control:e.jsx(B,{checked:p,onChange:()=>C(!p)}),label:p?e.jsx(U,{}):e.jsx(F,{})})})},"section-6.1")]}),l.isActive("table")&&e.jsxs("div",{className:`${n.toolbar} ${n.toolbar_sub}`,children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(16,18).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#6`))},"section-7"),e.jsx("div",{className:n.toolbar_section,children:a.slice(18,20).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#7`))},"section-8"),e.jsx("div",{className:n.toolbar_section,children:a.slice(20,22).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#8`))},"section-9"),e.jsx("div",{className:n.toolbar_section,children:a.slice(22,24).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#9`))},"section-10"),e.jsx("div",{className:n.toolbar_section,children:a.slice(24,26).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#10`))},"section-11")]}),p?e.jsx(P,{editor:l,className:"tiptap_content editor"}):e.jsx(W,{data:{...c(),content:JSON.stringify(r)}}),e.jsxs("div",{className:n.submit_menu,children:[e.jsx(Y,{onChange:t=>{m("publishDate",t)}}),e.jsxs(g,{onClick:D,className:n.submit_menu__item,children:[e.jsx(M,{}),"Сохранить изменения"]}),e.jsxs(g,{onClick:E,className:n.submit_menu__item,children:[e.jsx(Q,{}),"Отправить на модерацию"]})]})]})};export{dt as default};
