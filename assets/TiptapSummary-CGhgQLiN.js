import{i as F,r as d,u as L,k as U,z as q,g as K,A,a as M,q as z,j as e,E as H,v as I,S as V,B as X,t as G,p as Q}from"./index-Bikxwdcm.js";import{E as W}from"./EditOff-Cg9Co8Sq.js";import{A as E}from"./Add-th7y3UrN.js";import{u as Y,s as o,S as Z}from"./SaveAs-Bqr29o7P.js";import{B as tt}from"./index-B3OGdCLe.js";import{I as w,T as u}from"./index-DHKYCD40.js";import{g as et,F as st,S as nt}from"./getToolbarItems-DpbsxDU_.js";const j={type:"doc",content:[]},$=4,mt=()=>{var _;const{id:h}=F(),[C,N]=d.useState(!1),{focusedArticles:y}=L(s=>s.catalogs),D=U(),[g,k]=q(),T=Number(g.get("row"))||0,O=Number(g.get("column"))||0,[v,p]=Y({title:"",author:""}),[n,m]=d.useState(null),[a,S]=d.useState(T),[i,b]=d.useState(O),[f,J]=d.useState(!0);d.useEffect(()=>{n&&k({row:a,column:i})},[a,i,n]),d.useEffect(()=>{console.log("Загрузка данных статьи "),h&&(async()=>{try{const s=y.find(r=>r.id===h);if(s){const r=await K(s.content);Array.isArray(r)?m(r):(console.error("Некорректный формат данных из Files.get:",r),m([[j]])),p("",{title:s.title,author:s.author});return}const t=await A.getArticle(h);D(M(t)),Array.isArray(t.content)?m(t.content):(console.error("Некорректный формат данных из Admin.getArticle:",t.content),m([[j]])),p("",{title:t.title,author:t.author})}catch(s){console.error("Ошибка при загрузке статьи:",s),m([[j]])}})()},[h,y]);const c=z({extensions:G,content:n&&n[a]&&n[a][i]?n[a][i]:j,onUpdate:({editor:s})=>{const t=s.getJSON();m(r=>{if(!r||!r[a])return r;const x=[...r];return x[a]=[...x[a]],x[a][i]=t,N(!0),x})},editorProps:{handleKeyDown(s,t){return t.ctrlKey&&t.key==="Enter"?(s.dispatch(s.state.tr.insertText(`
`)),t.preventDefault(),!0):!1}}});d.useEffect(()=>{if(c&&n&&n[a]&&n[a][i]){const s=n[a][i],t=c.getJSON();if(JSON.stringify(s)!==JSON.stringify(t)){const r=c.state.selection;c.commands.setContent(s,!1),r&&c.commands.setTextSelection(r)}}},[a,i,n,c]),d.useEffect(()=>{const s=t=>{C&&(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[C]);const P=()=>{m(s=>{const t=[...s,[j]];return S(t.length-1),b(0),t})},R=()=>{m(s=>{const t=[...s],r=t[a];return r.length<$&&(t[a]=[...r,j]),t})},B=async()=>{if(!h||!n)return;const s={id:h,title:v("title"),content:n};try{const t=await A.saveArticle(s);N(!1),Q()}catch(t){console.error("Ошибка при сохранении:",t)}};if(!n)return e.jsx("div",{children:"Загрузка данных..."});if(!c)return null;const l=et({editor:c,styles:o});return e.jsxs("div",{className:o.tiptapeditor,children:[e.jsx(w,{name:"title",className:o.name,placeholder:"Введи название для справки",onChange:s=>p(s.currentTarget.name,s.currentTarget.value),value:v("title")}),e.jsxs("div",{className:o.toolbar,children:[e.jsx("div",{className:o.toolbar_section,children:l.slice(0,2).map((s,t)=>e.jsx(u,{title:s.name,children:e.jsx("button",{...s})},t))},"section-1"),e.jsx("div",{className:o.toolbar_section,children:l.slice(2,5).map((s,t)=>e.jsx(u,{title:s.name,children:e.jsx("button",{...s})},`${t}#1`))},"section-2"),e.jsx("div",{className:o.toolbar_section,children:l.slice(5,8).map((s,t)=>e.jsx(u,{title:s.name,children:e.jsx("button",{...s})},`${t}#2`))},"section-3"),e.jsxs("div",{className:o.toolbar_section,children:[l.slice(8,10).map((s,t)=>e.jsx(u,{title:s.name,children:e.jsx("button",{...s})},`${t}#3`)),e.jsx(w,{className:l[9].className,title:l[9].name,onChange:l[9].onChange,type:"file",children:l[9].children})]},"section-4"),e.jsx("div",{className:o.toolbar_section,children:l.slice(11,15).map((s,t)=>e.jsx(u,{title:s.name,children:e.jsx("button",{...s})},`${t}#4`))},"section-5"),e.jsx("div",{className:o.toolbar_section,children:e.jsx(st,{control:e.jsx(nt,{checked:f,onChange:()=>J(!f),color:"primary"}),label:f?e.jsx(H,{}):e.jsx(W,{})})})]}),e.jsxs("div",{className:`${o.toolbar} ${o.toolbar_sub}`,children:[e.jsxs("div",{className:o.toolbar_section,children:[Array.isArray(n)?n.map((s,t)=>e.jsx(u,{title:`Строка ${t+1}`,children:e.jsx("button",{className:`${o.toolbar__item} ${a===t&&o.active}`,onClick:()=>{S(t),b(0)},children:t+1})},t)):e.jsx("div",{children:"Ошибка: данные не загружены"}),e.jsx("div",{className:o.toolbar_section,children:e.jsxs("button",{className:`${o.toolbar__item}`,onClick:P,children:[e.jsx(E,{}),"Новая строка"]})})]}),e.jsxs("div",{className:o.toolbar_section,children:[Array.isArray(n)&&n[a]?n[a].map((s,t)=>e.jsx(u,{title:`Столбец ${t+1}`,children:e.jsx("button",{className:`${o.toolbar__item} ${i===t&&o.active}`,onClick:()=>b(t),children:t+1})},t)):e.jsx("div",{children:"Ошибка: данные строки не загружены"}),Array.isArray(n)&&((_=n[a])==null?void 0:_.length)<$&&e.jsx("div",{className:o.toolbar_section,children:e.jsxs("button",{className:`${o.toolbar__item}`,onClick:R,children:[e.jsx(E,{}),"Новый столбец"]})})]})]}),f&&n?e.jsx(I,{editor:c,className:"tiptap_content"}):e.jsx("pre",{children:JSON.stringify(n[a][i],null,2)}),e.jsx(V,{data:n,columns:4}),e.jsx("div",{className:o.toolbar,children:e.jsxs(tt,{onClick:B,className:o.submit_menu__item,children:[e.jsx(Z,{}),"Сохранить изменения"]})}),isDev&&e.jsx(X,{sx:{mt:2,p:2,backgroundColor:"var(--blue-admin-alt-color)",color:"var(--white-color)"},children:e.jsx("pre",{children:JSON.stringify(n,null,2)})})]})};export{mt as default};
