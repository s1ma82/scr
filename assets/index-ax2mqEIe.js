import{j as e,c as l,r as f,A as p,n as j,o as V,k,l as L,p as S,R as N,a as $,I as q,u as E,B as F,T as A,O}from"./index-q8pKR0Np.js";import{E as T}from"./Edit-Ck39ugGG.js";import{N as D}from"./NoteAdd-C6-2wMnV.js";import{M as _}from"./MenuItem-C0rskLLQ.js";const P=({children:t,...s})=>e.jsx("i",{"data-name":"bi",className:t,...s}),z=t=>{const s=t.split("_");if(!s)return{baseName:"name",isHidden:!1};const r=s.find(a=>a==="hidden"),c=s[0];return{isHidden:r,baseName:c}},R="_admin_155q5_1",B="_admin_container_155q5_5",G="_admin__tools_155q5_13",J="_tree_item_155q5_22",K="_back_155q5_25",Q="_article_title_155q5_46",U="_tree_item_dropdown_155q5_55",W="_active_155q5_60",X="_tree_item_header_155q5_63",Y="_tree_item_header_container_155q5_78",Z="_focused_155q5_91",ee="_admin__content_155q5_94",n={admin:R,admin_container:B,admin__tools:G,tree_item:J,back:K,article_title:Q,tree_item_dropdown:U,active:W,tree_item_header:X,tree_item_header_container:Y,focused:Z,admin__content:ee},te=l([e.jsx("path",{d:"M21 3H3c-1.1 0-2 .9-2 2v8h2V5h18v16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"},"0"),e.jsx("circle",{cx:"9",cy:"10",r:"4"},"1"),e.jsx("path",{d:"M15.39 16.56C13.71 15.7 11.53 15 9 15s-4.71.7-6.39 1.56C1.61 17.07 1 18.1 1 19.22V22h16v-2.78c0-1.12-.61-2.15-1.61-2.66"},"2")],"CoPresent"),se=l(e.jsx("path",{d:"m22 3-1.67 1.67L18.67 3 17 4.67 15.33 3l-1.66 1.67L12 3l-1.67 1.67L8.67 3 7 4.67 5.33 3 3.67 4.67 2 3v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zM11 19H4v-6h7zm9 0h-7v-2h7zm0-4h-7v-2h7zm0-4H4V8h16z"}),"Newspaper"),ne=l(e.jsx("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),ce=l(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections"),ie=l(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),ae=l(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),H=l(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),re=l(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-1 8h-3v3h-2v-3h-3v-2h3V9h2v3h3z"}),"CreateNewFolder"),oe=l(e.jsx("path",{d:"M22 3H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2M9 8c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3M2.08 19c1.38-2.39 3.96-4 6.92-4s5.54 1.61 6.92 4zm18.89-9.15-.75 1.3-1.47-.85V12h-1.5v-1.7l-1.47.85-.75-1.3L16.5 9l-1.47-.85.75-1.3 1.47.85V6h1.5v1.7l1.47-.85.75 1.3L19.5 9z"}),"ContactEmergency"),le=l(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),de=l(e.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),me=l(e.jsx("path",{d:"M3.5 9H5v6H3.5v-2.5h-2V15H0V9h1.5v2h2zm14 0H13c-.55 0-1 .45-1 1v5h1.5v-4.5h1V14H16v-3.51h1V15h1.5v-5c0-.55-.45-1-1-1M11 9H6v1.5h1.75V15h1.5v-4.5H11zm13 6v-1.5h-2.5V9H20v6z"}),"Html"),he={gallery:"Картинка",summary:"Шаблон справки",news:"Шаблон новости",pages:"Шаблон страницы",staff:"Шаблон сотрудника"},_e=({data:t,parent:s,children:r,className:c,onClick:a,isCatalog:d})=>{const[x,u]=f.useState(null),{baseName:y,isHidden:h}=z(t.name),g=!!x,C=m=>{m.preventDefault(),u(m.currentTarget)},i=f.useMemo(()=>async({type:m})=>{switch(m){case"rename":{let o=await prompt("Введите новое название для раздела: ");if(!o)return u(null);await p.renameCatalog({id:t.id,title:o,name:t.name}),j()}break;case"drop":{if(!await confirm(d?"Раздел удаляется со всеми дочерними элементами! Действительно удалить? ":"Вы действительно хотите удалить экземпляр? "))return;d?await p.dropCatalog(t.id):await p.dropArticle(t.id),j()}break;case"addArticle":await p.addArticle({...t,title:he[s]||"Экземпляр"}),j();break;case"addCatalog":{const o=await prompt("Введите название для раздела: "),v=await prompt("Введите текст для ссылки на раздел: (ENG)");if(!o){alert("Требуется ввести название и текст ссылки для создания раздела");return}const w=v||ct.transform(o,"_").toLowerCase();console.log(w),await p.addCatalog({id:t.id,title:o,name:w}),j()}break;case"hide":{const o=h?y:`${y}_hidden`;await p.renameCatalog({id:t.id,title:t.title,name:o}),j()}break;case"hardcode":await p.saveArticle({id:t.id,content_type:"html"}),j();break}u(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:c,onClick:a,id:"basic-button",onContextMenu:C,children:r}),e.jsxs(V,{id:"basic-menu",anchorEl:x,open:g,onClose:i,MenuListProps:{"aria-labelledby":"basic-button"},children:[d?e.jsxs(e.Fragment,{children:[e.jsxs(_,{onClick:()=>i({type:"addArticle"}),children:[e.jsx(D,{}),"Создать экземпляр"]}),e.jsxs(_,{onClick:()=>i({type:"addCatalog"}),children:[e.jsx(re,{}),"Создать раздел"]}),e.jsxs(_,{onClick:i,children:[e.jsx(oe,{}),"Права доступа"]}),e.jsxs(_,{onClick:()=>i({type:"rename"}),children:[e.jsx(T,{}),"Переименовать"]})]}):e.jsx(e.Fragment,{children:e.jsxs(_,{onClick:()=>i({type:"hardcode"}),children:[e.jsx(me,{}),"Превратить во Фрейм"]})}),e.jsxs(_,{onClick:()=>i({type:"hide"}),children:[e.jsx(H,{}),h?"Сделать видимым":"Сделать невидимым"]}),e.jsxs(_,{onClick:()=>i({type:"drop"}),children:[e.jsx(le,{}),"Удалить ",d?"раздел":"экземпляр"]}),e.jsxs(_,{onClick:()=>{navigator.clipboard.writeText(t.id),alert("Полный id скопирован в буфер обмена")},children:[e.jsx(de,{}),"ID: ",t.id.slice(0,6)]})]})]})},b={news:e.jsx(se,{}),pages:e.jsx(ne,{}),gallery:e.jsx(ce,{}),summary:e.jsx(q,{}),staff:e.jsx(ae,{})},I=({data:t,parent:s,params:r})=>{const{isHidden:c}=z(t.name),a=t.type==="catalog",d=L(),u=s?s&&a?`${s}/${t.name}`:`${s}/${t.id}`:t.name,y=r.id===t.id,[h,g]=f.useState(()=>{const i=localStorage.getItem("tree-expanded");return(i?JSON.parse(i):{})[t.id]||!1}),C=()=>{a&&g(i=>{const m=!i,o=localStorage.getItem("tree-expanded"),v=o?JSON.parse(o):{};return v[t.id]=m,localStorage.setItem("tree-expanded",JSON.stringify(v)),m})};return e.jsxs("div",{className:`${n.tree_item} ${h?n.active:""}`,children:[e.jsx("div",{onContextMenu:()=>!h&&C(),className:n.tree_item_header_container,children:e.jsx(_e,{parent:s,data:t,className:[n.tree_item_header,h?n.active:"",y?n.focused:""].join(" "),isCatalog:a,onClick:C,children:a?e.jsxs(e.Fragment,{children:[e.jsx("i",{children:e.jsx(S,{})}),b.hasOwnProperty(t.name)?b[t.name]:null,e.jsx("span",{children:t.title}),c&&e.jsx(H,{})]}):e.jsx(e.Fragment,{children:e.jsxs(N,{className:n.article_title,to:u,onClick:()=>d($(t)),children:[e.jsx(ie,{}),e.jsx("span",{children:t.title})]})})})}),a&&h&&"entries"in t&&t.entries&&e.jsx("div",{className:`${n.tree_item_dropdown} ${h?n.active:""}`,children:t.entries.map((i,m)=>e.jsx(I,{data:i,parent:u,params:r},m))})]})},xe=({catalogs:t})=>{const s=k();return t==null?void 0:t.map((r,c)=>e.jsx(I,{data:r,params:s},c))};function pe(){const{catalogs:t}=E(c=>c.catalogs),[s,r]=f.useState(!0);return f.useEffect(()=>{j()},[]),e.jsxs("div",{className:n.admin,children:[e.jsx(F,{onClick:()=>r(c=>!c),children:"Нажми чтобы скрыть/показать"}),e.jsxs("div",{className:n.admin_container,children:[s&&e.jsxs("div",{className:n.admin__tools,children:[e.jsxs(A,{size:"2em",children:[e.jsx(P,{children:"bi bi-gear"})," СКР-Админ"]}),e.jsx(xe,{catalogs:t}),e.jsx("div",{className:`${n.tree_item} ${n.back}`,children:e.jsxs(N,{className:n.tree_item_header,to:"/",children:[e.jsx(te,{})," Вернуться на сайт"]})})]}),e.jsx("div",{className:n.admin__content,children:e.jsx(O,{})})]})]})}const je="_admin_container_1p6wd_1",M={admin_container:je},ue=({children:t,className:s,...r})=>(f.useEffect(()=>{const c=document.querySelector("header"),a=document.querySelector("nav"),d=document.querySelector("footer"),x=document.querySelector("#wrapper");if(!(!c||!d||!a||!x))return c.style.display="none",d.style.display="none",a.style.display="none",x.classList.add("wrapper-admin"),()=>{x.classList.remove("wrapper-admin"),c.style.display="flex",d.style.display="flex",a.style.display="flex"}},[]),e.jsx("div",{className:`${M.admin} ${s}`,...r,children:e.jsx("div",{className:`flex column ${M.admin_container}`,children:e.jsx(pe,{})})})),ge=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{P as I,ge as a,ue as i};
