const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Mn7pVCiM.js","assets/index-C049ydR0.css"])))=>i.map(i=>d[i]);
import{c as I,j as e,r as u,g as N,L as $,t as y,k as A,u as L,l as k,K as T,A as _,a as O,N as P,G as J,Q as R,_ as H}from"./index-Mn7pVCiM.js";import{E as K}from"./Edit-DuQHJP4u.js";import{E as U}from"./EditOff-BsWIJcid.js";import{u as F,s as n,S as M}from"./SaveAs-BJnWVCYu.js";import{B as g}from"./index-BQCCF0QZ.js";import{I as b,T as i}from"./Tooltip-CWQSnHEO.js";import{g as z,F as B,S as q}from"./getToolbarItems-CufIeOEs.js";import{g as G}from"./index-DTsebtDM.js";import{A as Q}from"./index-DU8HSHYA.js";import"./Add-CmuGFdvn.js";import"./NoteAdd-BtjHKr9w.js";const V=I(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"Done"),W=({children:f,data:p,className:d,...x})=>{const[j,c]=u.useState(null);if(u.useEffect(()=>{p&&(async()=>{const{content:l}=await N(p.content);l&&c(l)})()},[p]),!j)return null;const m=G(j,y);return e.jsx($,{to:`/news/${p.id}`,...x,children:e.jsx("div",{className:"news_post tiptap_content",dangerouslySetInnerHTML:{__html:m}})})};var X={API_URL:"https://scr.opolo.me/api"};const Y=u.lazy(()=>H(()=>import("./index-Mn7pVCiM.js").then(f=>f.ao),__vite__mapDeps([0,1]))),dt=({initialContent:f,...p})=>{const{id:d}=A(),{focusedArticles:x}=L(t=>t.catalogs),j=k(),[c,m]=F({title:"",tags:[],publishDate:"",author:"",date:"",textOnly:"",avatar:""}),[l,S]=u.useState(),[h,C]=u.useState(!0),r=T({extensions:y,content:l,onUpdate:({editor:t})=>{const s=t.getJSON(),o=t.getText();m("textOnly",o),S(s)},editorProps:{handleKeyDown(t,s){return s.ctrlKey&&s.key==="Enter"?(t.dispatch(t.state.tr.insertText(`
`)),s.preventDefault(),!0):s.ctrlKey&&s.key==="k"?r?(s.preventDefault(),r.isActive("link")?(r.commands.unsetLink(),!0):(async()=>{const o=await prompt("Введите URL:");return o&&r.chain().focus().toggleLink({href:o}).run(),!0})()):void 0:!1}}});u.useEffect(()=>{d&&(async()=>{try{const t=x.find(o=>o.id===d);if(t){const o=await N(t.content),v={title:t.title,tags:o.tags,publishDate:o.publishDate,author:t.author,date:o.date,avatar:t.avatar};console.log("prevContent.content",o.content),r.commands.setContent(o.content),m("",v),console.log("Подгрузка из store: ",t);return}const s=await _.getArticle(d);console.log("Подгрузка с сервера: ",s),j(O(s));return}catch(t){console.error(t)}})()},[x,d]);const D=()=>{const t=localStorage.getItem("saved-news"),s=t?JSON.parse(t):[],o={...c(),content:JSON.stringify(l)};s.push(o),localStorage.setItem("saved-news",JSON.stringify(s))},E=async()=>{if(!d)return;const t=c("publishDate");console.log(l);const s={id:d,title:c("title"),content:l,text_only:c("textOnly"),avatar:c("avatar")};t&&(s.content.publishDate=t),await _.saveArticle(s)&&alert("Сохранно"),J()};if(u.useEffect(()=>{r&&r.setEditable(h)},[h]),!r)return null;const a=z({editor:r,styles:n}),w=async t=>{const s=t.target.files[0];if(!s)return;const o=await R(s);o&&m("avatar",o)};return e.jsxs("div",{className:`${n.tiptapeditor}`,...p,children:[e.jsx(b,{name:"title",className:n.name,placeholder:"Название статьи",onChange:t=>m(t.currentTarget.name,t.currentTarget.value),value:c("title")}),e.jsx("div",{className:n.avatar_container,children:e.jsx(i,{title:"Нажмите, чтобы сменить превью новости",children:e.jsx("div",{className:n.avatar,children:e.jsx(Q,{type:"editor",className:n.news,onChange:w,src:`${X.API_URL}/files/${c("avatar")}`,alt:c("name")})})})}),e.jsxs("div",{className:n.toolbar,children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(0,2).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},s))},"section-1"),e.jsx("div",{className:n.toolbar_section,children:a.slice(2,5).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#1`))},"section-2"),e.jsx("div",{className:n.toolbar_section,children:a.slice(5,8).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#2`))},"section-3"),e.jsxs("div",{className:n.toolbar_section,children:[a.slice(8,9).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#3`)),e.jsx(b,{className:a[9].className,title:a[9].name,onChange:a[9].onChange,type:"file",children:a[9].children}),e.jsx(b,{className:a[10].className,title:a[10].name,onChange:a[10].onChange,type:"file",children:a[10].children})]},"section-4"),e.jsx("div",{className:n.toolbar_section,children:a.slice(11,14).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#4`))},"section-5"),e.jsx("div",{className:n.toolbar_section,children:a.slice(14,16).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#5`))},"section-6"),e.jsx("div",{className:n.toolbar_section,children:e.jsx(i,{title:"режим редактирования",children:e.jsx(B,{control:e.jsx(q,{checked:h,onChange:()=>C(!h)}),label:h?e.jsx(K,{}):e.jsx(U,{})})})},"section-6.1")]}),r.isActive("table")&&e.jsxs("div",{className:`${n.toolbar} ${n.toolbar_sub}`,children:[e.jsx("div",{className:n.toolbar_section,children:a.slice(16,18).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#6`))},"section-7"),e.jsx("div",{className:n.toolbar_section,children:a.slice(18,20).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#7`))},"section-8"),e.jsx("div",{className:n.toolbar_section,children:a.slice(20,22).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#8`))},"section-9"),e.jsx("div",{className:n.toolbar_section,children:a.slice(22,24).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#9`))},"section-10"),e.jsx("div",{className:n.toolbar_section,children:a.slice(24,26).map((t,s)=>e.jsx(i,{title:t.name,children:e.jsx("button",{...t})},`${s}#10`))},"section-11")]}),h?e.jsx(P,{editor:r,className:"tiptap_content editor"}):e.jsx(W,{data:{...c(),content:JSON.stringify(l)}}),e.jsxs("div",{className:n.submit_menu,children:[e.jsx(Y,{onChange:t=>{m("publishDate",t)}}),e.jsxs(g,{onClick:E,className:n.submit_menu__item,children:[e.jsx(M,{}),"Сохранить изменения"]}),e.jsxs(g,{onClick:D,className:n.submit_menu__item,children:[e.jsx(V,{}),"Отправить на модерацию"]})]})]})};export{dt as default};
